name: sdn-ml

topology:
  nodes:
    s1:
      kind: linux
      image: openvswitch/ovs:2.11.2
      # Startup commands to configure the switch immediately
      exec:
        - /usr/share/openvswitch/scripts/ovs-ctl start
        - ovs-vsctl add-br br0
        - ovs-vsctl add-port br0 eth1
        - ovs-vsctl add-port br0 eth2
        - ovs-vsctl add-port br0 eth3
        - ovs-vsctl add-port br0 eth4
        # Connect to controller (Using host.docker.internal to reach Windows)
        - ovs-vsctl set-controller br0 tcp:host.docker.internal:6653
        - ovs-vsctl set bridge br0 protocols=OpenFlow13

    h1:
      kind: linux
      image: ghcr.io/srl-labs/network-multitool
      exec:
        - ip addr add 10.0.0.1/24 dev eth1
    h2:
      kind: linux
      image: ghcr.io/srl-labs/network-multitool
      exec:
        - ip addr add 10.0.0.2/24 dev eth1
    h3:
      kind: linux
      image: ghcr.io/srl-labs/network-multitool
      exec:
        - ip addr add 10.0.0.3/24 dev eth1
    h4:
      kind: linux
      image: ghcr.io/srl-labs/network-multitool
      exec:
        - ip addr add 10.0.0.4/24 dev eth1

  links:
    - endpoints: ["s1:eth1", "h1:eth1"]
    - endpoints: ["s1:eth2", "h2:eth1"]
    - endpoints: ["s1:eth3", "h3:eth1"]
    - endpoints: ["s1:eth4", "h4:eth1"]
